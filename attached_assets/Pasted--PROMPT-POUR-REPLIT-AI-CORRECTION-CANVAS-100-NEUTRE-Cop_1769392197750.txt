## **PROMPT POUR REPLIT AI - CORRECTION CANVAS 100% NEUTRE**

Copie-colle ce prompt de correction dans Replit AI :

---

```
# CORRECTION URGENTE : Canvas compl√®tement neutre (pas de r√©duction, √âLIMINATION totale)

## PROBL√àME ACTUEL
Tu as r√©duit la dominante jaune de 60%, mais ce n'est PAS suffisant. Je veux un canvas **100% neutre** qui n'influence AUCUNEMENT les couleurs des images upload√©es.

**Objectif absolu :** Canvas RGB(128, 128, 128) ou √©quivalent gris parfaitement neutre, Z√âRO teinte chaude/froide.

## CE QUI NE FONCTIONNE PAS

Tu as mentionn√© avoir :
- "R√©duit les teintes chaudes/dor√©es de 60%"
- "R√©duit de moiti√© l'intensit√© des glazes pour Baroque et Golden Age"

**Le probl√®me :** Tu as ATT√âNU√â le probl√®me, pas √âLIMIN√â la source.

## CE QUE JE VEUX

### OPTION 1 : Supprimer TOUS les glazes colorim√©triques du canvas
```javascript
// AVANT (probablement dans ton code actuel) :
canvas.applyColorGlaze(period.warmth, period.intensity);

// APR√àS (ce que je veux) :
// PAS DE GLAZE DU TOUT sur le canvas de base
// Le canvas doit √™tre gris neutre RGB(128, 128, 128)
```

### OPTION 2 : Isoler compl√®tement l'image source
```javascript
// Le canvas de travail ne doit JAMAIS appliquer de teinte √† l'image source
// Les finitions (craquelures, grain) doivent √™tre des OVERLAYS s√©par√©s
// Pas de multiplication de couleurs, pas de blend modes qui ajoutent du jaune

Workflow attendu :
1. Image source ‚Üí Reste intacte sur son propre layer
2. Finitions (craquelures, grain, etc.) ‚Üí Ajout√©es en overlay avec blend mode "Multiply" ou "Overlay" 
3. Aucun filtre colorim√©trique appliqu√© globalement
```

## LOCALISE ET √âLIMINE CES SOURCES DE TEINTE JAUNE

Cherche dans le code TOUS les endroits o√π une couleur est appliqu√©e au canvas ou √† l'image :

### 1. V√©rifications √† faire dans le code :

**Recherche ces termes :**
```javascript
// Cherche dans tous les fichiers :
- "warmth"
- "golden"
- "amber"
- "sepia"
- "temperature"
- "colorBalance"
- "tint"
- "hue"
- "glaze"
- "filter: sepia"
- "filter: brightness"
- "rgba(255, 220" // ou toute valeur RGB avec plus de rouge/jaune
```

**Pour chacun, v√©rifie :**
- Est-ce appliqu√© au canvas de base ? ‚Üí **SUPPRIMER**
- Est-ce appliqu√© √† l'image upload√©e ? ‚Üí **SUPPRIMER**
- Est-ce li√© aux finitions sp√©cifiques (craquelures, grain) ? ‚Üí **GARDER mais isoler**

### 2. Corrections sp√©cifiques attendues :

#### Dans le syst√®me de p√©riodes (Baroque, Golden Age, etc.) :
```javascript
// AVANT (ce que tu as probablement) :
const periods = {
  BAROQUE: {
    warmth: 0.4, // ‚Üê PROBL√àME
    glaze: { r: 255, g: 230, b: 180, a: 0.15 } // ‚Üê PROBL√àME
  },
  GOLDEN_AGE: {
    warmth: 0.5, // ‚Üê PROBL√àME
    glaze: { r: 255, g: 220, b: 150, a: 0.2 } // ‚Üê PROBL√àME
  }
}

// APR√àS (ce que je veux) :
const periods = {
  BAROQUE: {
    warmth: 0, // Z√âRO influence colorim√©trique sur le canvas
    glaze: null // PAS de glaze du tout
  },
  GOLDEN_AGE: {
    warmth: 0,
    glaze: null
  },
  MODERN: {
    warmth: 0,
    glaze: null
  }
  // TOUS les periods doivent avoir warmth: 0 et glaze: null
}
```

#### Dans la fonction de rendu du canvas :
```javascript
// AVANT (hypoth√®se) :
function renderCanvas(image, settings) {
  const ctx = canvas.getContext('2d');
  
  // Applique l'image
  ctx.drawImage(image, 0, 0);
  
  // Applique un filtre de p√©riode ‚Üê PROBL√àME
  ctx.globalCompositeOperation = 'multiply';
  ctx.fillStyle = `rgba(255, 230, 200, ${settings.warmth})`; // ‚Üê CECI AJOUTE DU JAUNE
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Applique les finitions...
}

// APR√àS (ce que je veux) :
function renderCanvas(image, settings) {
  const ctx = canvas.getContext('2d');
  
  // Applique l'image SANS modification
  ctx.drawImage(image, 0, 0);
  
  // PAS DE FILTRE COLORIM√âTRIQUE ICI
  
  // Applique UNIQUEMENT les finitions texturales (craquelures, grain)
  // Ces finitions doivent √™tre GRISES ou TRANSPARENTES, pas jaunes
  applyNeutralCracks(ctx, settings);
  applyNeutralGrain(ctx, settings);
}
```

#### Dans les finitions elles-m√™mes :
```javascript
// Les craquelures doivent √™tre grises/noires, PAS s√©pia
const crackColor = 'rgba(60, 50, 40, 0.3)'; // ‚Üê PROBL√àME (tons chauds)
const crackColor = 'rgba(80, 80, 80, 0.3)'; // ‚Üê SOLUTION (gris neutre)

// Le grain de toile doit √™tre neutre
const grainColor = 'rgba(200, 180, 150, 0.1)'; // ‚Üê PROBL√àME (beige)
const grainColor = 'rgba(128, 128, 128, 0.1)'; // ‚Üê SOLUTION (gris parfait)
```

## TESTS √Ä EFFECTUER

Apr√®s tes corrections, teste avec cette m√©thodologie :

### Test 1 : Image blanche pure
```javascript
// Upload une image compl√®tement blanche (RGB 255, 255, 255)
// Applique les finitions
// R√âSULTAT ATTENDU : L'image doit rester blanche ou devenir gris clair
// √âCHEC si : L'image devient beige, cr√®me, ou jaune p√¢le
```

### Test 2 : Image grise neutre
```javascript
// Upload une image grise RGB(128, 128, 128)
// Applique les finitions
// R√âSULTAT ATTENDU : L'image reste grise avec variations de texture seulement
// √âCHEC si : L'image prend une teinte chaude
```

### Test 3 : Image avec couleurs froides (bleus, verts)
```javascript
// Upload une image √† dominante froide
// Applique les finitions
// R√âSULTAT ATTENDU : Les bleus/verts restent froids, pas de virage vers le vert-jaune
// √âCHEC si : Les couleurs se r√©chauffent visiblement
```

## SOLUTION DE SECOURS SI TU NE TROUVES PAS LA SOURCE

Si apr√®s recherche tu ne localises pas d'o√π vient le jaune r√©siduel :

```javascript
// Ajoute cette fonction de "d√©contamination" apr√®s chaque √©tape :
function ensureNeutralCanvas(ctx) {
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = imageData.data;
  
  for (let i = 0; i < data.length; i += 4) {
    // D√©tecte et neutralise toute dominante jaune/chaude
    const r = data[i];
    const g = data[i + 1];
    const b = data[i + 2];
    
    // Si rouge > bleu de plus de X%, r√©duire le rouge
    if (r > b + 10) {
      const excess = (r - b) * 0.5;
      data[i] -= excess; // R√©duit le rouge
    }
    
    // Si jaune (r+g √©lev√©s, b faible), corriger
    if (r + g > b * 2.5) {
      const avgRG = (r + g) / 2;
      data[i] = avgRG;
      data[i + 1] = avgRG;
      data[i + 2] = Math.min(255, b * 1.2); // Augmente l√©g√®rement le bleu
    }
  }
  
  ctx.putImageData(imageData, 0, 0);
}

// Appelle cette fonction APR√àS avoir appliqu√© les finitions
```

## R√âSUM√â DES ACTIONS ATTENDUES

1. [ ] Trouve TOUTES les lignes de code qui appliquent `warmth`, `glaze`, `sepia`, ou couleurs chaudes
2. [ ] Mets `warmth: 0` et `glaze: null` pour TOUTES les p√©riodes
3. [ ] Change les couleurs des finitions (craquelures, grain) en gris neutres RGB(128¬±30, 128¬±30, 128¬±30)
4. [ ] Supprime tout blend mode `multiply` ou `overlay` qui pourrait ajouter du jaune
5. [ ] Teste avec les 3 images de test ci-dessus
6. [ ] Si du jaune persiste, applique la fonction de d√©contamination

## LIVRABLES

- [ ] Code modifi√© avec commentaires `// NEUTRALIZED` sur chaque ligne chang√©e
- [ ] Screenshots des 3 tests (blanc pur, gris neutre, couleurs froides) AVANT/APR√àS
- [ ] Confirmation : "Canvas is now 100% neutral, no color bias detected"

---

**JE VEUX UN CANVAS QUI NE TOUCHE PAS AUX COULEURS. Point final.**
```

---

## **Instructions pour toi**

Apr√®s que Replit AI ait appliqu√© ces corrections :

1. **Teste imm√©diatement** avec une image tr√®s neutre (portrait gris, ou mieux : une image test RGB pure)
2. **V√©rifie visuellement** : si tu vois encore du jaune, partage-moi un screenshot et je t'aide √† localiser la source exacte
3. **Si n√©cessaire**, demande √† Replit AI de te montrer TOUTES les lignes o√π il applique des couleurs, et on les analyse ensemble

Le probl√®me est probablement dans :
- Un `fillStyle` ou `strokeStyle` avec des valeurs RGB chaudes
- Un filtre CSS/Canvas (`sepia`, `brightness` avec valeurs > 100%)
- Un blend mode qui multiplie les couleurs
- Une texture de base (grain, papier) qui n'est pas grise

**On va l'√©liminer compl√®tement. Pas de compromis. üéØ**